#include "defs.h"
#include "bitboards.h"


/*VARIABLES*/
const U64 NOT_A_FILE=18374403900871474942ULL;
const U64 NOT_H_FILE=9187201950435737471ULL;
const U64 NOT_HG_FILE=4557430888798830399ULL;
const U64 NOT_AB_FILE=18229723555195321596ULL;
const U64 kingsideBB=17361641481138401520ULL;
const U64 queensideBB=1085102592571150095ULL;
const U64 darksquaresBB=12273903644374837845ULL;
const U64 lightsquaresBB=6172840429334713770ULL;
const U64 LONG_DIAGONALS = 0x8142241818244281ull;
const U64 CENTER_SQUARES = 0x0000001818000000ull;
const U64 CENTER_BIG     = 0x00003C3C3C3C0000ull;
const U64 WhitePassedMark[BOARD_NUMS_SQ]={
    217020518514230016ULL,
506381209866536704ULL,
1012762419733073408ULL,
2025524839466146816ULL,
4051049678932293632ULL,
8102099357864587264ULL,
16204198715729174528ULL,
13889313184910721024ULL,
217020518514229248ULL,
506381209866534912ULL,
1012762419733069824ULL,
2025524839466139648ULL,
4051049678932279296ULL,
8102099357864558592ULL,
16204198715729117184ULL,
13889313184910671872ULL,
217020518514032640ULL,
506381209866076160ULL,
1012762419732152320ULL,
2025524839464304640ULL,
4051049678928609280ULL,
8102099357857218560ULL,
16204198715714437120ULL,
13889313184898088960ULL,
217020518463700992ULL,
506381209748635648ULL,
1012762419497271296ULL,
2025524838994542592ULL,
4051049677989085184ULL,
8102099355978170368ULL,
16204198711956340736ULL,
13889313181676863488ULL,
217020505578799104ULL,
506381179683864576ULL,
1012762359367729152ULL,
2025524718735458304ULL,
4051049437470916608ULL,
8102098874941833216ULL,
16204197749883666432ULL,
13889312357043142656ULL,
217017207043915776ULL,
506373483102470144ULL,
1012746966204940288ULL,
2025493932409880576ULL,
4050987864819761152ULL,
8101975729639522304ULL,
16203951459279044608ULL,
13889101250810609664ULL,
216172782113783808ULL,
504403158265495552ULL,
1008806316530991104ULL,
2017612633061982208ULL,
4035225266123964416ULL,
8070450532247928832ULL,
16140901064495857664ULL,
13835058055282163712ULL,
0ULL,
0ULL,
0ULL,
0ULL,
0ULL,
0ULL,
0ULL,
0ULL
};

const U64 BlackPassedMask[BOARD_NUMS_SQ]={
    0ULL,
0ULL,
0ULL,
0ULL,
0ULL,
0ULL,
0ULL,
0ULL,
3ULL,
7ULL,
14ULL,
28ULL,
56ULL,
112ULL,
224ULL,
192ULL,
771ULL,
1799ULL,
3598ULL,
7196ULL,
14392ULL,
28784ULL,
57568ULL,
49344ULL,
197379ULL,
460551ULL,
921102ULL,
1842204ULL,
3684408ULL,
7368816ULL,
14737632ULL,
12632256ULL,
50529027ULL,
117901063ULL,
235802126ULL,
471604252ULL,
943208504ULL,
1886417008ULL,
3772834016ULL,
3233857728ULL,
12935430915ULL,
30182672135ULL,
60365344270ULL,
120730688540ULL,
241461377080ULL,
482922754160ULL,
965845508320ULL,
827867578560ULL,
3311470314243ULL,
7726764066567ULL,
15453528133134ULL,
30907056266268ULL,
61814112532536ULL,
123628225065072ULL,
247256450130144ULL,
211934100111552ULL,
847736400446211ULL,
1978051601041159ULL,
3956103202082318ULL,
7912206404164636ULL,
15824412808329272ULL,
31648825616658544ULL,
63297651233317088ULL,
54255129628557504ULL
};

const U64 IsolatedMask[BOARD_NUMS_SQ]={
144680345676153346ULL,
361700864190383365ULL,
723401728380766730ULL,
1446803456761533460ULL,
2893606913523066920ULL,
5787213827046133840ULL,
11574427654092267680ULL,
4629771061636907072ULL,
144680345676153346ULL,
361700864190383365ULL,
723401728380766730ULL,
1446803456761533460ULL,
2893606913523066920ULL,
5787213827046133840ULL,
11574427654092267680ULL,
4629771061636907072ULL,
144680345676153346ULL,
361700864190383365ULL,
723401728380766730ULL,
1446803456761533460ULL,
2893606913523066920ULL,
5787213827046133840ULL,
11574427654092267680ULL,
4629771061636907072ULL,
144680345676153346ULL,
361700864190383365ULL,
723401728380766730ULL,
1446803456761533460ULL,
2893606913523066920ULL,
5787213827046133840ULL,
11574427654092267680ULL,
4629771061636907072ULL,
144680345676153346ULL,
361700864190383365ULL,
723401728380766730ULL,
1446803456761533460ULL,
2893606913523066920ULL,
5787213827046133840ULL,
11574427654092267680ULL,
4629771061636907072ULL,
144680345676153346ULL,
361700864190383365ULL,
723401728380766730ULL,
1446803456761533460ULL,
2893606913523066920ULL,
5787213827046133840ULL,
11574427654092267680ULL,
4629771061636907072ULL,
144680345676153346ULL,
361700864190383365ULL,
723401728380766730ULL,
1446803456761533460ULL,
2893606913523066920ULL,
5787213827046133840ULL,
11574427654092267680ULL,
4629771061636907072ULL,
144680345676153346ULL,
361700864190383365ULL,
723401728380766730ULL,
1446803456761533460ULL,
2893606913523066920ULL,
5787213827046133840ULL,
11574427654092267680ULL,
4629771061636907072ULL
};

const U64 FileBBMask[FILE_NONE]={
72340172838076673ULL,
144680345676153346ULL,
289360691352306692ULL,
578721382704613384ULL,
1157442765409226768ULL,
2314885530818453536ULL,
4629771061636907072ULL,
9259542123273814144ULL
};

const U64 RankBBMask[RANK_NONE]={
255ULL,
65280ULL,
16711680ULL,
4278190080ULL,
1095216660480ULL,
280375465082880ULL,
71776119061217280ULL,
18374686479671623680ULL
};

const U64 ClearMask[BOARD_NUMS_SQ]={
    18446744073709551614ULL,
18446744073709551613ULL,
18446744073709551611ULL,
18446744073709551607ULL,
18446744073709551599ULL,
18446744073709551583ULL,
18446744073709551551ULL,
18446744073709551487ULL,
18446744073709551359ULL,
18446744073709551103ULL,
18446744073709550591ULL,
18446744073709549567ULL,
18446744073709547519ULL,
18446744073709543423ULL,
18446744073709535231ULL,
18446744073709518847ULL,
18446744073709486079ULL,
18446744073709420543ULL,
18446744073709289471ULL,
18446744073709027327ULL,
18446744073708503039ULL,
18446744073707454463ULL,
18446744073705357311ULL,
18446744073701163007ULL,
18446744073692774399ULL,
18446744073675997183ULL,
18446744073642442751ULL,
18446744073575333887ULL,
18446744073441116159ULL,
18446744073172680703ULL,
18446744072635809791ULL,
18446744071562067967ULL,
18446744069414584319ULL,
18446744065119617023ULL,
18446744056529682431ULL,
18446744039349813247ULL,
18446744004990074879ULL,
18446743936270598143ULL,
18446743798831644671ULL,
18446743523953737727ULL,
18446742974197923839ULL,
18446741874686296063ULL,
18446739675663040511ULL,
18446735277616529407ULL,
18446726481523507199ULL,
18446708889337462783ULL,
18446673704965373951ULL,
18446603336221196287ULL,
18446462598732840959ULL,
18446181123756130303ULL,
18445618173802708991ULL,
18444492273895866367ULL,
18442240474082181119ULL,
18437736874454810623ULL,
18428729675200069631ULL,
18410715276690587647ULL,
18374686479671623679ULL,
18302628885633695743ULL,
18158513697557839871ULL,
17870283321406128127ULL,
17293822569102704639ULL,
16140901064495857663ULL,
13835058055282163711ULL,
9223372036854775807ULL
};

const U64 OutpostSquareMasks[BOTH][BOARD_NUMS_SQ]={
    {
    144680345676153344ULL,
361700864190383360ULL,
723401728380766720ULL,
1446803456761533440ULL,
2893606913523066880ULL,
5787213827046133760ULL,
11574427654092267520ULL,
4629771061636907008ULL,
144680345676152832ULL,
361700864190382080ULL,
723401728380764160ULL,
1446803456761528320ULL,
2893606913523056640ULL,
5787213827046113280ULL,
11574427654092226560ULL,
4629771061636890624ULL,
144680345676021760ULL,
361700864190054400ULL,
723401728380108800ULL,
1446803456760217600ULL,
2893606913520435200ULL,
5787213827040870400ULL,
11574427654081740800ULL,
4629771061632696320ULL,
144680345642467328ULL,
361700864106168320ULL,
723401728212336640ULL,
1446803456424673280ULL,
2893606912849346560ULL,
5787213825698693120ULL,
11574427651397386240ULL,
4629771060558954496ULL,
144680337052532736ULL,
361700842631331840ULL,
723401685262663680ULL,
1446803370525327360ULL,
2893606741050654720ULL,
5787213482101309440ULL,
11574426964202618880ULL,
4629770785681047552ULL,
144678138029277184ULL,
361695345073192960ULL,
723390690146385920ULL,
1446781380292771840ULL,
2893562760585543680ULL,
5787125521171087360ULL,
11574251042342174720ULL,
4629700416936869888ULL,
144115188075855872ULL,
360287970189639680ULL,
720575940379279360ULL,
1441151880758558720ULL,
2882303761517117440ULL,
5764607523034234880ULL,
11529215046068469760ULL,
4611686018427387904ULL,
0ULL,
0ULL,
0ULL,
0ULL,
0ULL,
0ULL,
0ULL,
0ULL
}
,
{
    0ULL,
0ULL,
0ULL,
0ULL,
0ULL,
0ULL,
0ULL,
0ULL,
2ULL,
5ULL,
10ULL,
20ULL,
40ULL,
80ULL,
160ULL,
64ULL,
514ULL,
1285ULL,
2570ULL,
5140ULL,
10280ULL,
20560ULL,
41120ULL,
16448ULL,
131586ULL,
328965ULL,
657930ULL,
1315860ULL,
2631720ULL,
5263440ULL,
10526880ULL,
4210752ULL,
33686018ULL,
84215045ULL,
168430090ULL,
336860180ULL,
673720360ULL,
1347440720ULL,
2694881440ULL,
1077952576ULL,
8623620610ULL,
21559051525ULL,
43118103050ULL,
86236206100ULL,
172472412200ULL,
344944824400ULL,
689889648800ULL,
275955859520ULL,
2207646876162ULL,
5519117190405ULL,
11038234380810ULL,
22076468761620ULL,
44152937523240ULL,
88305875046480ULL,
176611750092960ULL,
70644700037184ULL,
565157600297474ULL,
1412894000743685ULL,
2825788001487370ULL,
5651576002974740ULL,
11303152005949480ULL,
22606304011898960ULL,
45212608023797920ULL,
18085043209519168ULL
}

};

const U64 ForwardFileMasks[BOTH][BOARD_NUMS_SQ]={
    {
        72340172838076673ULL,
144680345676153346ULL,
289360691352306692ULL,
578721382704613384ULL,
1157442765409226768ULL,
2314885530818453536ULL,
4629771061636907072ULL,
9259542123273814144ULL,
72340172838076672ULL,
144680345676153344ULL,
289360691352306688ULL,
578721382704613376ULL,
1157442765409226752ULL,
2314885530818453504ULL,
4629771061636907008ULL,
9259542123273814016ULL,
72340172838076416ULL,
144680345676152832ULL,
289360691352305664ULL,
578721382704611328ULL,
1157442765409222656ULL,
2314885530818445312ULL,
4629771061636890624ULL,
9259542123273781248ULL,
72340172838010880ULL,
144680345676021760ULL,
289360691352043520ULL,
578721382704087040ULL,
1157442765408174080ULL,
2314885530816348160ULL,
4629771061632696320ULL,
9259542123265392640ULL,
72340172821233664ULL,
144680345642467328ULL,
289360691284934656ULL,
578721382569869312ULL,
1157442765139738624ULL,
2314885530279477248ULL,
4629771060558954496ULL,
9259542121117908992ULL,
72340168526266368ULL,
144680337052532736ULL,
289360674105065472ULL,
578721348210130944ULL,
1157442696420261888ULL,
2314885392840523776ULL,
4629770785681047552ULL,
9259541571362095104ULL,
72339069014638592ULL,
144678138029277184ULL,
289356276058554368ULL,
578712552117108736ULL,
1157425104234217472ULL,
2314850208468434944ULL,
4629700416936869888ULL,
9259400833873739776ULL,
72057594037927936ULL,
144115188075855872ULL,
288230376151711744ULL,
576460752303423488ULL,
1152921504606846976ULL,
2305843009213693952ULL,
4611686018427387904ULL,
9223372036854775808ULL
    },
    {
        1ULL,
2ULL,
4ULL,
8ULL,
16ULL,
32ULL,
64ULL,
128ULL,
257ULL,
514ULL,
1028ULL,
2056ULL,
4112ULL,
8224ULL,
16448ULL,
32896ULL,
65793ULL,
131586ULL,
263172ULL,
526344ULL,
1052688ULL,
2105376ULL,
4210752ULL,
8421504ULL,
16843009ULL,
33686018ULL,
67372036ULL,
134744072ULL,
269488144ULL,
538976288ULL,
1077952576ULL,
2155905152ULL,
4311810305ULL,
8623620610ULL,
17247241220ULL,
34494482440ULL,
68988964880ULL,
137977929760ULL,
275955859520ULL,
551911719040ULL,
1103823438081ULL,
2207646876162ULL,
4415293752324ULL,
8830587504648ULL,
17661175009296ULL,
35322350018592ULL,
70644700037184ULL,
141289400074368ULL,
282578800148737ULL,
565157600297474ULL,
1130315200594948ULL,
2260630401189896ULL,
4521260802379792ULL,
9042521604759584ULL,
18085043209519168ULL,
36170086419038336ULL,
72340172838076673ULL,
144680345676153346ULL,
289360691352306692ULL,
578721382704613384ULL,
1157442765409226768ULL,
2314885530818453536ULL,
4629771061636907072ULL,
9259542123273814144ULL
    }

};

const U64 OutpostRanksMasks[BOTH]={
    281474959933440ULL,
1099511562240ULL};

const U64 PawnConnectedMasks[BOTH][BOARD_NUMS_SQ]={
    {
        0ULL,
0ULL,0ULL,0ULL,0ULL,0ULL,0ULL,0ULL,514ULL,
1285ULL,2570ULL,5140ULL,10280ULL,20560ULL,41120ULL,16448ULL,131584ULL,
328960ULL,657920ULL,1315840ULL,2631680ULL,5263360ULL,10526720ULL,4210688ULL,33685504ULL,
84213760ULL,168427520ULL,336855040ULL,673710080ULL,1347420160ULL,2694840320ULL,1077936128ULL,8623489024ULL,
21558722560ULL,43117445120ULL,86234890240ULL,172469780480ULL,344939560960ULL,689879121920ULL,275951648768ULL,2207613190144ULL,
5519032975360ULL,11038065950720ULL,22076131901440ULL,44152263802880ULL,88304527605760ULL,176609055211520ULL,70643622084608ULL,565148976676864ULL,
1412872441692160ULL,2825744883384320ULL,5651489766768640ULL,11302979533537280ULL,22605959067074560ULL,45211918134149120ULL,18084767253659648ULL,0ULL,
0ULL,0ULL,0ULL,0ULL,0ULL,0ULL,0ULL
    },
    {
        0ULL,
0ULL,0ULL,0ULL,0ULL,0ULL,0ULL,0ULL,131584ULL,
328960ULL,657920ULL,1315840ULL,2631680ULL,5263360ULL,10526720ULL,4210688ULL,33685504ULL,
84213760ULL,168427520ULL,336855040ULL,673710080ULL,1347420160ULL,2694840320ULL,1077936128ULL,8623489024ULL,
21558722560ULL,43117445120ULL,86234890240ULL,172469780480ULL,344939560960ULL,689879121920ULL,275951648768ULL,2207613190144ULL,
5519032975360ULL,11038065950720ULL,22076131901440ULL,44152263802880ULL,88304527605760ULL,176609055211520ULL,70643622084608ULL,565148976676864ULL,
1412872441692160ULL,2825744883384320ULL,5651489766768640ULL,11302979533537280ULL,22605959067074560ULL,45211918134149120ULL,18084767253659648ULL,144678138029277184ULL,
361695345073192960ULL,723390690146385920ULL,1446781380292771840ULL,2893562760585543680ULL,5787125521171087360ULL,11574251042342174720ULL,4629700416936869888ULL,0ULL,
0ULL,0ULL,0ULL,0ULL,0ULL,0ULL,0ULL
    }
};

const U64 KingAreasMask[BOTH][BOARD_NUMS_SQ]={
    {
460551ULL,460551ULL,921102ULL,1842204ULL,3684408ULL,7368816ULL,14737632ULL,14737632ULL,117901063ULL,
117901063ULL,235802126ULL,471604252ULL,943208504ULL,1886417008ULL,3772834016ULL,3772834016ULL,30182672128ULL,
30182672128ULL,60365344256ULL,120730688512ULL,241461377024ULL,482922754048ULL,965845508096ULL,965845508096ULL,7726764064768ULL,
7726764064768ULL,15453528129536ULL,30907056259072ULL,61814112518144ULL,123628225036288ULL,247256450072576ULL,247256450072576ULL,1978051600580608ULL,
1978051600580608ULL,3956103201161216ULL,7912206402322432ULL,15824412804644864ULL,31648825609289728ULL,63297651218579456ULL,63297651218579456ULL,506381209748635648ULL,
506381209748635648ULL,1012762419497271296ULL,2025524838994542592ULL,4051049677989085184ULL,8102099355978170368ULL,16204198711956340736ULL,16204198711956340736ULL,506381179683864576ULL,
506381179683864576ULL,1012762359367729152ULL,2025524718735458304ULL,4051049437470916608ULL,8102098874941833216ULL,16204197749883666432ULL,16204197749883666432ULL,506373483102470144ULL,
506373483102470144ULL,1012746966204940288ULL,2025493932409880576ULL,4050987864819761152ULL,8101975729639522304ULL,16203951459279044608ULL,16203951459279044608ULL
    },
    {
1799ULL,1799ULL,3598ULL,7196ULL,14392ULL,28784ULL,57568ULL,57568ULL,460551ULL,
460551ULL,921102ULL,1842204ULL,3684408ULL,7368816ULL,14737632ULL,14737632ULL,117901063ULL,
117901063ULL,235802126ULL,471604252ULL,943208504ULL,1886417008ULL,3772834016ULL,3772834016ULL,30182672128ULL,
30182672128ULL,60365344256ULL,120730688512ULL,241461377024ULL,482922754048ULL,965845508096ULL,965845508096ULL,7726764064768ULL,
7726764064768ULL,15453528129536ULL,30907056259072ULL,61814112518144ULL,123628225036288ULL,247256450072576ULL,247256450072576ULL,1978051600580608ULL,
1978051600580608ULL,3956103201161216ULL,7912206402322432ULL,15824412804644864ULL,31648825609289728ULL,63297651218579456ULL,63297651218579456ULL,506381209748635648ULL,
506381209748635648ULL,1012762419497271296ULL,2025524838994542592ULL,4051049677989085184ULL,8102099355978170368ULL,16204198711956340736ULL,16204198711956340736ULL,506381179683864576ULL,
506381179683864576ULL,1012762359367729152ULL,2025524718735458304ULL,4051049437470916608ULL,8102098874941833216ULL,16204197749883666432ULL,16204197749883666432ULL
    }
};

const int KingPawnFileDistance[FILE_NONE][1<<FILE_NONE]={
    {
        0,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,
        1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,6,0,1,0,
        2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,
        1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,7,0,1,0,2,0,1,0,
        3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,
        1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,6,0,1,0,2,0,1,0,3,0,1,0,
        2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,
        1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0
    },
    {
        0,1,0,0,1,1,0,0,2,1,0,0,1,1,0,0,3,1,0,0,1,1,0,0,2,1,0,0,1,1,0,0,4,1,
        0,0,1,1,0,0,2,1,0,0,1,1,0,0,3,1,0,0,1,1,0,0,2,1,0,0,1,1,0,0,5,1,0,0,
        1,1,0,0,2,1,0,0,1,1,0,0,3,1,0,0,1,1,0,0,2,1,0,0,1,1,0,0,4,1,0,0,1,1,
        0,0,2,1,0,0,1,1,0,0,3,1,0,0,1,1,0,0,2,1,0,0,1,1,0,0,6,1,0,0,1,1,0,0,
        2,1,0,0,1,1,0,0,3,1,0,0,1,1,0,0,2,1,0,0,1,1,0,0,4,1,0,0,1,1,0,0,2,1,
        0,0,1,1,0,0,3,1,0,0,1,1,0,0,2,1,0,0,1,1,0,0,5,1,0,0,1,1,0,0,2,1,0,0,
        1,1,0,0,3,1,0,0,1,1,0,0,2,1,0,0,1,1,0,0,4,1,0,0,1,1,0,0,2,1,0,0,1,1,
        0,0,3,1,0,0,1,1,0,0,2,1,0,0,1,1,0,0
    },
    {
        0,2,1,1,0,0,0,0,1,1,1,1,0,0,0,0,2,2,1,1,0,0,0,0,1,1,1,1,0,0,0,0,3,2,
        1,1,0,0,0,0,1,1,1,1,0,0,0,0,2,2,1,1,0,0,0,0,1,1,1,1,0,0,0,0,4,2,1,1,
        0,0,0,0,1,1,1,1,0,0,0,0,2,2,1,1,0,0,0,0,1,1,1,1,0,0,0,0,3,2,1,1,0,0,
        0,0,1,1,1,1,0,0,0,0,2,2,1,1,0,0,0,0,1,1,1,1,0,0,0,0,5,2,1,1,0,0,0,0,
        1,1,1,1,0,0,0,0,2,2,1,1,0,0,0,0,1,1,1,1,0,0,0,0,3,2,1,1,0,0,0,0,1,1,
        1,1,0,0,0,0,2,2,1,1,0,0,0,0,1,1,1,1,0,0,0,0,4,2,1,1,0,0,0,0,1,1,1,1,
        0,0,0,0,2,2,1,1,0,0,0,0,1,1,1,1,0,0,0,0,3,2,1,1,0,0,0,0,1,1,1,1,0,0,
        0,0,2,2,1,1,0,0,0,0,1,1,1,1,0,0,0,0
    },
    {
        0,3,2,2,1,1,1,1,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,2,2,
        2,2,1,1,1,1,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,3,3,2,2,
        1,1,1,1,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,2,2,2,2,1,1,
        1,1,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,4,3,2,2,1,1,1,1,
        0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,2,2,2,2,1,1,1,1,0,0,
        0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,3,3,2,2,1,1,1,1,0,0,0,0,
        0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,2,2,2,2,1,1,1,1,0,0,0,0,0,0,
        0,0,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0
    },
    {
        0,4,3,3,2,2,2,2,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,
        1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,
        2,2,2,2,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,
        1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,3,2,2,2,2,
        1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,
        1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,2,2,1,1,1,1,
        1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
        1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
    },
    {
        0,5,4,4,3,3,3,3,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,
        1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,2,2,
        2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,
        1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
    },
    {
        0,6,5,5,4,4,4,4,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,
        1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,
        1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
        1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
    },
    {
        0,7,6,6,5,5,5,5,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,
        2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,
        1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
        1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
    }

};

const U64 ForwardRanksMasks[BOTH][RANK_NONE]={
    {
    18446744073709551615ULL,
    18446744073709551360ULL,
    18446744073709486080ULL,
    18446744073692774400ULL,
    18446744069414584320ULL,
    18446742974197923840ULL,
    18446462598732840960ULL,
    18374686479671623680ULL
    },
    {
    255ULL,
    65535ULL,
    16777215ULL,
    4294967295ULL,
    1099511627775ULL,
    281474976710655ULL,
    72057594037927935ULL,
    18446744073709551615ULL
    }
};

const int PromoteSquare[BOTH][FILE_NONE]={
    {
        A8,
        B8,
        C8,
        D8,
        E8,
        F8,
        G8,
        H8
    },
    {
        A1,
        B1,
        C1,
        D1,
        E1,
        F1,
        G1,
        H1
    }

};


/*FUNCTIONS*/
int boardHasNonPawnMaterial(S_BOARD *pos, int turn) {
    ASSERT(SideValid(turn));
    U64 friendly = pos->occupancy[turn];
    U64 kings    = pos->bitboards[wK] | pos->bitboards[bK];
    U64 pawns    = pos->bitboards[wP] | pos->bitboards[bP];
    return (friendly & (kings | pawns)) != friendly;
}

U64 pawnPassedMark(int color,int sq){
    ASSERT(SideValid(color));
    ASSERT(SqOnBoard(sq));
    return color==WHITE ? WhitePassedMark[sq]:BlackPassedMask[sq];
}

U64 getOutpostSquareMasks(int color,int sq){
    ASSERT(SideValid(color));
    ASSERT(SqOnBoard(sq));
    return color==WHITE ? OutpostSquareMasks[WHITE][sq]:OutpostSquareMasks[BLACK][sq];
}

U64 getOutpostRanksMasks(int color){
    ASSERT(SideValid(color));
    return color==WHITE ? OutpostRanksMasks[WHITE]:OutpostRanksMasks[BLACK];
}

U64 forwardRanksMasks(int color,int rank){
    ASSERT(SideValid(color));
    ASSERT(FileRankValid(rank));
    return ForwardRanksMasks[color][rank];
}

int kingPawnFileDistance(U64 pawns, int ksq) {
    ASSERT(SqOnBoard(ksq));
    pawns |= pawns >> 8; pawns |= pawns >> 16; pawns |= pawns >> 32;
    return KingPawnFileDistance[filesBoard[ksq]][pawns & 0xFF];
}

int getmsb(U64 bb) {
    return __builtin_clzll(bb) ^ 63;
}

U64 KingAreaMasks(int color,int sq){
    ASSERT(SideValid(color));
    ASSERT(SqOnBoard(sq));
    return KingAreasMask[color][sq];
}

bool testBit(U64 bb, int i) {
    ASSERT(SqOnBoard(i));
    return bb & (1Ull << i);
}

int mirrorFile(int file) {
    ASSERT(FileRankValid(file));
    static const int Mirror[] = {0,1,2,3,3,2,1,0};
    return Mirror[file];
}

int relativeRankOf(int colour, int sq) {
    ASSERT(SideValid(colour));
    ASSERT(SqOnBoard(sq));
    return colour == WHITE ? ranksBoard[sq] : 7 - ranksBoard[sq];
}

int relativeSquare32(int colour, int sq) {
    ASSERT(SideValid(colour));
    ASSERT(SqOnBoard(sq));
    return 4 * relativeRankOf(colour, sq) + mirrorFile(filesBoard[sq]);
}

bool several(U64 bb) {
    return bb & (bb - 1);
}

U64 pawnAdvance(U64 pawns, U64 occupied, int colour) {
    ASSERT(SideValid(colour));
    return ~occupied & (colour == WHITE ? (pawns << 8) : (pawns >> 8));
}

int openFileCount(U64 pawns) {
    pawns |= pawns >> 8; pawns |= pawns >> 16; pawns |= pawns >> 32;
    return COUNTBIT(~pawns & 0xFF);
}

U64 squaresOfMatchingColour(int sq) {
    ASSERT(SqOnBoard(sq));
    return testBit(lightsquaresBB, sq) ? lightsquaresBB : darksquaresBB;
}

bool onlyOne(U64 bb) {
    return bb && !several(bb);
}

int poplsb(U64 *bb) {
    int lsb = LSBINDEX(*bb);
    *bb &= *bb - 1;
    return lsb;
}

int backmost(int colour, U64 bb) {
    ASSERT(SideValid(colour));
    return colour == WHITE ? LSBINDEX(bb) : getmsb(bb);
}
